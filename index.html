<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>6æ ¼å°çº¢ä¹¦æ”¹å†™ç³»ç»Ÿ</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Microsoft YaHei", sans-serif; }
    body { margin: 0; background: #0b0c10; color: #eaeaea; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }
    .card { background: #11131a; border: 1px solid #24283a; border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    h1 { font-size: 18px; margin: 0 0 6px; }
    .sub { opacity: .75; font-size: 13px; margin-bottom: 14px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .row { display: grid; gap: 8px; padding: 12px; border: 1px solid #24283a; border-radius: 14px; background: #0f1118; }
    .rowhead { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .tag { font-size: 12px; opacity: .8; }
    textarea {
      width: 100%; min-height: 86px; resize: vertical;
      background: #0b0c10; color: #eaeaea;
      border: 1px solid #2a2f46; border-radius: 12px;
      padding: 10px; line-height: 1.45;
      outline: none;
    }
    textarea:focus { border-color: #5b6cff; box-shadow: 0 0 0 3px rgba(91,108,255,.15); }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin: 14px 0 10px; }
    button {
      cursor: pointer; border: 1px solid #2a2f46;
      background: #14182a; color: #eaeaea; border-radius: 12px;
      padding: 10px 12px; font-weight: 600;
    }
    button.primary { background: #5b6cff; border-color: #5b6cff; color: #0b0c10; }
    button:disabled { opacity: .5; cursor: not-allowed; }
    select, input {
      background: #0b0c10; color: #eaeaea;
      border: 1px solid #2a2f46; border-radius: 12px;
      padding: 10px 12px;
      outline: none;
    }
    .final { margin-top: 14px; display: grid; gap: 10px; }
    .status { font-size: 13px; opacity: .85; min-height: 18px; }
    .hint { font-size: 12px; opacity: .65; margin-top: 10px; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>6æ ¼ç½‘é¡µå°ç³»ç»Ÿï¼šAI å°çº¢ä¹¦å†™æ‰‹ï¼ˆå¹²è´§åˆ©è½ï¼‰æ”¹å†™ + ä¹˜æ³•æ‹¼æ¥</h1>
      <div class="sub">å·¦è¾¹æ”¾åŸå¥ï¼Œå³è¾¹è‡ªåŠ¨ç”ŸæˆåŒä¹‰æ”¹å†™ã€‚æœ€åç”¨ â€œÃ—â€ ä¸²æˆä¸€æ®µï¼Œç›´æ¥å¤åˆ¶å°±èƒ½å‘ã€‚</div>

      <div class="controls">
        <label class="tag">é£æ ¼ï¼š</label>
        <select id="style">
          <option value="xiaohongshu" selected>å°çº¢ä¹¦å†™æ‰‹ï¼ˆå¹²è´§åˆ©è½ï¼‰</option>
          <option value="whatsapp">WhatsAppï¼ˆæ›´å£è¯­ã€çŸ­å¥ï¼‰</option>
          <option value="formal">æ­£å¼ï¼ˆæ›´å•†åŠ¡ï¼‰</option>
        </select>

        <label class="tag">è¿æ¥ç¬¦ï¼š</label>
        <input id="joiner" value=" Ã— " style="width:100px" />

        <button class="primary" id="btnRewrite">ä¸€é”®æ”¹å†™ 6 å¥</button>
        <button id="btnJoin">æ‹¼æ¥æˆä¸€æ®µ</button>
        <button id="btnCopy">å¤åˆ¶æœ€ç»ˆæ®µè½</button>
      </div>

      <div class="status" id="status"></div>

      <div class="grid" id="grid"></div>

      <div class="final">
        <div class="tag">æœ€ç»ˆæ®µè½ï¼ˆå¯ç¼–è¾‘ï¼‰ï¼š</div>
        <textarea id="finalText" placeholder="è¿™é‡Œä¼šå‡ºç°æ‹¼æ¥åçš„æ®µè½â€¦"></textarea>
      </div>

      <div class="hint">å°æŠ€å·§ï¼šä½ ä¹Ÿå¯ä»¥åªå¡«å…¶ä¸­å‡ æ ¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è·³è¿‡ç©ºç™½æ ¼ã€‚</div>
    </div>
  </div>

<script>
  const grid = document.getElementById('grid');
  const statusEl = document.getElementById('status');
  const finalText = document.getElementById('finalText');

  // ç”Ÿæˆ6è¡Œ
  Array.from({length: 6}).forEach((_, i) => {
    const row = document.createElement('div');
    row.className = 'row';
    row.innerHTML = `
      <div class="rowhead">
        <div class="tag">ç¬¬ ${i+1} æ ¼</div>
        <button data-one="${i}" title="åªæ”¹å†™è¿™ä¸€æ ¼">æ”¹å†™è¿™ä¸€æ ¼</button>
      </div>
      <textarea data-in="${i}" placeholder="è¾“å…¥åŸå¥ï¼ˆç¬¬ ${i+1} å¥ï¼‰â€¦"></textarea>
      <textarea data-out="${i}" placeholder="åŒä¹‰æ”¹å†™ä¼šå‡ºç°åœ¨è¿™é‡Œï¼ˆç¬¬ ${i+1} å¥ï¼‰â€¦"></textarea>
    `;
    grid.appendChild(row);
  });

  function setStatus(msg) { statusEl.textContent = msg || ''; }
  function getInputs() {
    return Array.from(document.querySelectorAll('textarea[data-in]')).map(t => t.value.trim());
  }
  function getOutputs() {
    return Array.from(document.querySelectorAll('textarea[data-out]')).map(t => t.value.trim());
  }
  function setOutputs(arr) {
    const outs = Array.from(document.querySelectorAll('textarea[data-out]'));
    outs.forEach((t, i) => t.value = arr[i] ?? '');
  }

  async function callRewrite(sentences, style) {
    const res = await fetch('/api/rewrite', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ sentences, style })
    });
    if (!res.ok) {
      const text = await res.text().catch(()=> '');
      throw new Error(`API error (${res.status}): ${text || 'unknown'}`);
    }
    return res.json();
  }

  async function rewriteAll() {
    const style = document.getElementById('style').value;
    const sentences = getInputs();
    if (sentences.every(s => !s)) return setStatus('ä½ å…ˆå¡«è‡³å°‘ä¸€å¥ï¼Œæˆ‘æ‰æœ‰ä¸œè¥¿æ”¹å†™ ğŸ˜„');

    setStatus('AI æ­£åœ¨æ”¹å†™ä¸­â€¦');
    const btn = document.getElementById('btnRewrite');
    btn.disabled = true;

    try {
      const data = await callRewrite(sentences, style);
      setOutputs(data.rewrites || []);
      setStatus('æ”¹å†™å®Œæˆ âœ… ä½ å¯ä»¥å†ç‚¹ã€Œæ‹¼æ¥æˆä¸€æ®µã€');
    } catch (e) {
      setStatus('å‡ºé”™äº†ï¼š' + e.message);
    } finally {
      btn.disabled = false;
    }
  }

  async function rewriteOne(idx) {
    const style = document.getElementById('style').value;
    const sentences = getInputs();
    if (!sentences[idx]) return setStatus(`ç¬¬ ${idx+1} æ ¼æ˜¯ç©ºçš„ï¼Œå…ˆå¡«ä¸€å¥å†æ”¹å†™ï½`);

    setStatus(`AI æ­£åœ¨æ”¹å†™ç¬¬ ${idx+1} æ ¼â€¦`);
    try {
      const data = await callRewrite(sentences.map((s,i)=> i===idx ? s : ""), style);
      const outs = getOutputs();
      outs[idx] = (data.rewrites || [])[idx] || '';
      setOutputs(outs);
      setStatus(`ç¬¬ ${idx+1} æ ¼æ”¹å†™å®Œæˆ âœ…`);
    } catch (e) {
      setStatus('å‡ºé”™äº†ï¼š' + e.message);
    }
  }

  function joinFinal() {
    const joiner = document.getElementById('joiner').value ?? ' Ã— ';
    const outs = getOutputs().filter(Boolean);
    if (!outs.length) return setStatus('å³è¾¹è¿˜æ²¡æœ‰æ”¹å†™å†…å®¹ï½å…ˆæ”¹å†™å†æ‹¼æ¥');
    finalText.value = outs.join(joiner);
    setStatus('å·²æ‹¼æ¥æˆä¸€æ®µ âœ…');
  }

  async function copyFinal() {
    const text = finalText.value.trim();
    if (!text) return setStatus('æœ€ç»ˆæ®µè½æ˜¯ç©ºçš„ï½å…ˆæ‹¼æ¥ä¸€ä¸‹');
    await navigator.clipboard.writeText(text);
    setStatus('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ âœ…');
  }

  document.getElementById('btnRewrite').addEventListener('click', rewriteAll);
  document.getElementById('btnJoin').addEventListener('click', joinFinal);
  document.getElementById('btnCopy').addEventListener('click', copyFinal);

  // æ¯è¡Œçš„â€œæ”¹å†™è¿™ä¸€æ ¼â€
  document.querySelectorAll('button[data-one]').forEach(btn => {
    btn.addEventListener('click', () => rewriteOne(Number(btn.dataset.one)));
  });
</script>
</body>
</html>
